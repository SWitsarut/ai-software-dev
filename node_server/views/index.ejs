<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Potree Viewer</title>

    <link rel="stylesheet" type="text/css" href="<%= libpath %>/build/potree/potree.css">
    <link rel="stylesheet" type="text/css" href="<%= libpath %>/libs/jquery-ui/jquery-ui.min.css">
    <link rel="stylesheet" type="text/css" href="<%= libpath %>/libs/openlayers3/ol.css">
    <link rel="stylesheet" type="text/css" href="<%= libpath %>/libs/spectrum/spectrum.css">
    <link rel="stylesheet" type="text/css" href="<%= libpath %>/libs/jstree/themes/mixed/style.css">
</head>

<body>
    <script src="<%= libpath %>/libs/jquery/jquery-3.1.1.min.js"></script>
    <script src="<%= libpath %>/libs/spectrum/spectrum.js"></script>
    <script src="<%= libpath %>/libs/jquery-ui/jquery-ui.min.js"></script>
    <script src="<%= libpath %>/libs/other/BinaryHeap.js"></script>
    <script src="<%= libpath %>/libs/tween/tween.min.js"></script>
    <script src="<%= libpath %>/libs/d3/d3.js"></script>
    <script src="<%= libpath %>/libs/proj4/proj4.js"></script>
    <script src="<%= libpath %>/libs/openlayers3/ol.js"></script>
    <script src="<%= libpath %>/libs/i18next/i18next.js"></script>
    <script src="<%= libpath %>/libs/jstree/jstree.js"></script>
    <script src="<%= libpath %>/build/potree/potree.js"></script>
    <script src="<%= libpath %>/libs/plasio/js/laslaz.js"></script>

    <div class="potree_container" style="position: absolute; width: 100%; height: 100%; left: 0px; top: 0px; ">
        <div id="potree_render_area" style="background-image: url('<%= libpath %>/build/potree/resources/images/background.jpg');">

            <span style="position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); z-index: 10000">
                <!-- <input type="button" value="Default Scheme" onclick="setDefaultScheme()" />
                <input type="button" value="Tree Scheme" onclick="setTreeScheme()" />
                <input type="button" value="All Scheme" onclick="setAllScheme()" /> -->
            </span>

        </div>
        <div id="potree_sidebar_container"> </div>
    </div>

    <script type="module">

        import * as THREE from "<%= libpath %>/libs/three.js/build/three.module.js";

        window.viewer = new Potree.Viewer(document.getElementById("potree_render_area"));
        const url = '<%= libpath %>/out/metadata.json'
        const description = `Classification <a target='_blank' href=`+url +` >PG&E</a> `
        console.log(description)
		viewer.setDescription(description);

        viewer.setEDLEnabled(true);
        viewer.setFOV(60);
        viewer.setPointBudget(2_000_000);

        viewer.loadGUI(() => {
            $("#menu_filters").next().show();
            viewer.toggleSidebar();
        });


        const interest_scheme={
                0: { visible: true, name: "Unlabeled", color: [0.5, 0.5, 0.5, 1.0] },
                1: { visible: true, name: "Outlier", color: [1.0, 0.0, 0.0, 1.0] },
                2: { visible: true, name: "Car", color: [0.0, 0.0, 1.0, 1.0] },
                3: { visible: true, name: "Bicycle", color: [0.5, 0.5, 0.0, 1.0] },
                4: { visible: true, name: "Bus", color: [1.0, 0.5, 0.0, 1.0] },
                5: { visible: true, name: "Motorcycle", color: [1.0, 0.0, 1.0, 1.0] },
                6: { visible: true, name: "On-rails", color: [0.0, 1.0, 1.0, 1.0] },
                7: { visible: true, name: "Truck", color: [0.3, 0.3, 0.7, 1.0] },
                8: { visible: true, name: "Other vehicle", color: [0.7, 0.7, 0.3, 1.0] },
                9: { visible: true, name: "Person", color: [1.0, 1.0, 0.0, 1.0] },
                10: { visible: true, name: "Bicyclist", color: [0.0, 1.0, 0.5, 1.0] },
                11: { visible: true, name: "Motorcyclist", color: [0.8, 0.2, 0.5, 1.0] },
                12: { visible: true, name: "Road", color: [0.2, 0.2, 0.2, 1.0] },
                13: { visible: true, name: "Parking", color: [0.4, 0.4, 0.4, 1.0] },
                14: { visible: true, name: "Sidewalk", color: [0.6, 0.6, 0.6, 1.0] },
                15: { visible: true, name: "Other ground", color: [0.5, 0.3, 0.2, 1.0] },
                16: { visible: true, name: "Building", color: [0.3, 0.5, 0.7, 1.0] },
                17: { visible: true, name: "Fence", color: [0.7, 0.5, 0.3, 1.0] },
                18: { visible: true, name: "Other structure", color: [0.8, 0.4, 0.2, 1.0] },
                19: { visible: true, name: "Lane marking", color: [1.0, 1.0, 1.0, 1.0] },
                20: { visible: true, name: "Vegetation", color: [0.0, 1.0, 0.0, 1.0] },
                21: { visible: true, name: "Trunk", color: [0.6, 0.3, 0.0, 1.0] },
                22: { visible: true, name: "Terrain", color: [0.3, 0.6, 0.0, 1.0] },
                23: { visible: true, name: "Pole", color: [0.8, 0.8, 0.0, 1.0] },
                24: { visible: true, name: "Traffic sign", color: [0.8, 0.0, 0.0, 1.0] },
                25: { visible: true, name: "Other object", color: [0.5, 0.0, 0.5, 1.0] },
                26: { visible: true, name: "Moving car", color: [0.0, 0.5, 1.0, 1.0] },
                27: { visible: true, name: "Moving bicyclist", color: [0.3, 0.7, 1.0, 1.0] },
                28: { visible: true, name: "Moving person", color: [1.0, 0.3, 0.7, 1.0] },
                29: { visible: true, name: "Moving motorcyclist", color: [0.6, 0.2, 0.8, 1.0] },
                30: { visible: true, name: "Moving on-rails", color: [0.5, 1.0, 0.3, 1.0] },
                31: { visible: true, name: "Moving bus", color: [1.0, 0.6, 0.2, 1.0] },
                32: { visible: true, name: "Moving truck", color: [0.2, 0.6, 1.0, 1.0] },
                33: { visible: true, name: "Moving other vehicle", color: [0.7, 0.2, 1.0, 1.0] },
                DEFAULT: { visible: false, name: "Unknown", color: [0.0, 0.0, 0.0, 1.0] }
            }

        Potree.loadPointCloud(url).then(e => {
            let pointcloud = e.pointcloud;
            let material = pointcloud.material;

            // material.activeAttributeName = "rgba";
            material.minSize = 2;
            material.pointSizeType = Potree.PointSizeType.ADAPTIVE;

            viewer.scene.addPointCloud(pointcloud);
            viewer.fitToScreen();
            viewer.setClassifications(interest_scheme)
        });

    </script>

    <script type="module">

        // // import * as THREE from "../libs/three.js/build/three.module.js";

        // window.setAllScheme = function () {
        //     viewer.setClassifications(interest_scheme);
        // };


		// window.setDefaultScheme = function(){
		// 	viewer.setClassifications(Potree.ClassificationScheme.DEFAULT);
		// }



        // window.setTreeScheme = function () {
        //     viewer.setClassifications({
        //         5: { visible: true, name: 'trees', color: [0.0, 1.0, 0.0, 1.0] },
        //         DEFAULT: { visible: false, name: 'other', color: [0.0, 0.0, 0.0, 1.0] },
        //     });
        // }

        // // window.setRandomScheme = function () {
        // //     const scheme = {};

        // //     for (let i = 0; i < 32; i++) {
        // //         scheme[i] = { visible: true, name: `random:_${i}`, color: [Math.random(), Math.random(), Math.random(), 1.0] };
        // //     }

        // //     viewer.setClassifications(scheme);
        // // }
        
    </script>


</body>

</html>